generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Favorite {
  id        Int      @id @default(autoincrement())
  userId    String
  productId String
  category  String
  createdAt DateTime @default(now())
}

model ProductAnalytics {
  id                Int      @id @default(autoincrement())
  productId         String   @unique
  priceDrop         Float
  priceIncrease     Float
  percentageChange  Float
  isBuyRecommended  String
  isOnSale          Boolean
  previousPrice     Float?
  priceChangeStatus String
  averagePrice      Float?
  medianPrice       Float? // New field for median price
  priceStdDev       Float? // New field for standard deviation of price
  promotionImpact   Float? // New field for measuring impact of promotions
  lastCalculated    DateTime
  createdAt         DateTime @default(now()) // New field for record creation timestamp
  updatedAt         DateTime @updatedAt // New field for record update timestamp

  // Relations to all product models (now one-to-many)
  ovocieAZeleniny        OvocieAZeleniny[]
  grilovanie             Grilovanie[]
  pecivo                 Pecivo[]
  masoRybyALahodky       MasoRybyALahodky[]
  mliecneVyrobkyAVajcia  MliecneVyrobkyAVajcia[]
  trvanlivePotraviny     TrvanlivePotraviny[]
  specialnaAZdravaVyziva SpecialnaAZdravaVyziva[]
  mrazenePotraviny       MrazenePotraviny[]
  napoje                 Napoje[]
  alkohol                Alkohol[]

  @@unique([productId, lastCalculated])
}

model OvocieAZeleniny {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  analyticsId         Int?
  analytics           ProductAnalytics? @relation(fields: [analyticsId], references: [id])

  @@unique([productId, lastUpdated])
}

model Grilovanie {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  ProductAnalytics    ProductAnalytics? @relation(fields: [productAnalyticsId], references: [id])
  productAnalyticsId  Int?

  @@unique([productId, lastUpdated])
}

model Pecivo {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  ProductAnalytics    ProductAnalytics? @relation(fields: [productAnalyticsId], references: [id])
  productAnalyticsId  Int?

  @@unique([productId, lastUpdated])
}

model MasoRybyALahodky {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  ProductAnalytics    ProductAnalytics? @relation(fields: [productAnalyticsId], references: [id])
  productAnalyticsId  Int?

  @@unique([productId, lastUpdated])
}

model MliecneVyrobkyAVajcia {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  ProductAnalytics    ProductAnalytics? @relation(fields: [productAnalyticsId], references: [id])
  productAnalyticsId  Int?

  @@unique([productId, lastUpdated])
}

model TrvanlivePotraviny {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  ProductAnalytics    ProductAnalytics? @relation(fields: [productAnalyticsId], references: [id])
  productAnalyticsId  Int?

  @@unique([productId, lastUpdated])
}

model SpecialnaAZdravaVyziva {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  ProductAnalytics    ProductAnalytics? @relation(fields: [productAnalyticsId], references: [id])
  productAnalyticsId  Int?

  @@unique([productId, lastUpdated])
}

model MrazenePotraviny {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  ProductAnalytics    ProductAnalytics? @relation(fields: [productAnalyticsId], references: [id])
  productAnalyticsId  Int?

  @@unique([productId, lastUpdated])
}

model Napoje {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  ProductAnalytics    ProductAnalytics? @relation(fields: [productAnalyticsId], references: [id])
  productAnalyticsId  Int?

  @@unique([productId, lastUpdated])
}

model Alkohol {
  id                  Int               @id @default(autoincrement())
  productId           String
  title               String
  price               Float
  unitPrice           Float
  imageUrl            String
  unitOfMeasure       String
  isForSale           Boolean
  aisleName           String
  promotions          Promotion[]
  lastUpdated         DateTime
  category            String
  superDepartmentName String
  hasPromotions       Boolean
  ProductAnalytics    ProductAnalytics? @relation(fields: [productAnalyticsId], references: [id])
  productAnalyticsId  Int?

  @@unique([productId, lastUpdated])
}

model Promotion {
  id                       Int                     @id @default(autoincrement())
  promotionId              String
  promotionType            String
  startDate                DateTime
  endDate                  DateTime
  offerText                String
  promotionPrice           Float? // Add this line
  attributes               String[]
  ovocieAZeleniny          OvocieAZeleniny?        @relation(fields: [ovocieAZeleninyId], references: [id])
  ovocieAZeleninyId        Int?
  grilovanie               Grilovanie?             @relation(fields: [grilovanieId], references: [id])
  grilovanieId             Int?
  mliecneVyrobkyAVajcia    MliecneVyrobkyAVajcia?  @relation(fields: [mliecneVyrobkyAVajciaId], references: [id])
  mliecneVyrobkyAVajciaId  Int?
  pecivo                   Pecivo?                 @relation(fields: [pecivoId], references: [id])
  pecivoId                 Int?
  masoRybyALahodky         MasoRybyALahodky?       @relation(fields: [masoRybyALahodkyId], references: [id])
  masoRybyALahodkyId       Int?
  trvanlivePotraviny       TrvanlivePotraviny?     @relation(fields: [trvanlivePotravinyId], references: [id])
  trvanlivePotravinyId     Int?
  specialnaAZdravaVyziva   SpecialnaAZdravaVyziva? @relation(fields: [specialnaAZdravaVyzivaId], references: [id])
  specialnaAZdravaVyzivaId Int?
  mrazenePotraviny         MrazenePotraviny?       @relation(fields: [mrazenePotravinyId], references: [id])
  mrazenePotravinyId       Int?
  napoje                   Napoje?                 @relation(fields: [napojeId], references: [id])
  napojeId                 Int?
  alkohol                  Alkohol?                @relation(fields: [alkoholId], references: [id])
  alkoholId                Int?
}
